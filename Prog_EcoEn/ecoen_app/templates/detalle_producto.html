{% extends "base.html" %}
{% load static %}
{% block content %}

<section class="container py-5 fade-in">
  <div class="row g-4 align-items-center">
    <!-- Imagen del producto -->
    <div class="col-md-6 text-center">
      <img src="{{ producto.imagen.url }}" 
           class="img-fluid rounded shadow-lg scale-up" 
           alt="{{ producto.nombre }}" 
           style="max-height: 400px; object-fit: cover;">
    </div>

    <div class="col-md-6">
      <h2 class="fw-bold mb-3 text-success">{{ producto.nombre }}</h2>
      <p class="lead text-muted">{{ producto.descripcion }}</p>
      <p class="text-success fw-bold fs-5">üí≤ Precio: ${{ producto.precio|floatformat:0 }} ARS</p>
      <p class="text-warning fs-6">‚≠ê Promedio: {{ producto.promedio_puntuacion }} / 5</p>

      <!-- Rating interactivo -->
      <div class="rating mb-4 d-flex gap-1" role="radiogroup" aria-label="Calificaci√≥n del producto">
        {% for i in "12345" %}
          {% with val=i|stringformat:"i" %}
            <span class="star {% if puntuacion_usuario|stringformat:"s" >= val %}selected{% endif %}" 
                  data-value="{{ val }}" role="radio" aria-label="{{ val }} estrellas">‚òÖ</span>
          {% endwith %}
        {% endfor %}
      </div>

      <!-- Botones -->
      <div class="d-flex gap-3">
        <button class="btn btn-outline-success add-to-cart fw-bold"
                data-product="{{ producto.nombre }}"
                data-price="{{ producto.precio }}"
                data-product-id="{{ producto.id }}">
          üõí Agregar al carrito
        </button>
        <a href="{% url 'productos' %}" class="btn btn-secondary fw-bold">‚¨Ö Volver</a>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Carrito
    const boton = document.querySelector(".add-to-cart");
    boton.addEventListener("click", () => {
      const nombre = boton.dataset.product;
      const precio = parseFloat(boton.dataset.price);
      const id = boton.dataset.productId;

      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      let existente = carrito.find(item => item.id === id);

      if (existente) {
        existente.cantidad += 1;
      } else {
        carrito.push({ id, nombre, precio, cantidad: 1 });
      }

      localStorage.setItem("carrito", JSON.stringify(carrito));

      // Feedback visual
      boton.classList.add("bounce");
      setTimeout(() => boton.classList.remove("bounce"), 600);

      alert(`${nombre} agregado al carrito ‚úÖ`);
    });

    // Rating interactivo
    const estrellas = document.querySelectorAll(".star");
    estrellas.forEach(star => {
      star.addEventListener("click", () => {
        estrellas.forEach(s => s.classList.remove("selected"));
        star.classList.add("selected");

        // Feedback visual
        star.classList.add("scale-up");
        setTimeout(() => star.classList.remove("scale-up"), 300);

        alert(`Calificaste con ${star.dataset.value} ‚≠ê`);
        // Aqu√≠ podr√≠as enviar la puntuaci√≥n al backend v√≠a AJAX
      });
    });
  });
</script>

{% endblock %}
