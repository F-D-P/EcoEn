<!DOCTYPE html>
<html lang="es" data-bs-theme="light">
<head>
    {% load static %}
    {% load socialaccount %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoEn</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'images/faviconTT.png' %}" />

    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Estilos propios -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
</head>
<body class="light-mode {% block body_class %}{% endblock %}">

{% if request.resolver_match.url_name != 'custom_login' and request.resolver_match.url_name != 'custom_signup' %}
  <!-- BotÃ³n hamburguesa -->
  <div id="menu-toggle" onclick="toggleMenu()" class="menu-toggle"
       aria-controls="menu-lateral"
       aria-expanded="false"
       aria-label="Abrir menÃº">
    <span id="menu-icon" data-default="â˜°" class="closed">â˜°</span>
  </div>

  <!-- Overlay -->
  <div id="menu-overlay" class="menu-overlay" aria-hidden="true"></div>

  <!-- MenÃº lateral -->
  <div id="menu-lateral" class="menu-lateral" role="dialog" aria-hidden="true" aria-label="MenÃº lateral">
    <div class="menu-stack">
      {% if user.is_authenticated %}
        <p class="menu-header">ğŸ‘‹ Hola, {{ user.username }}</p>
        <a href="{% url 'custom_logout' %}" class="btn btn-danger">Cerrar sesiÃ³n</a>
      {% else %}
        <a href="{% url 'custom_login' %}" class="btn btn-primary">ğŸ” Iniciar sesiÃ³n</a>
      {% endif %}

      <a href="{% url 'mi_perfil' %}" class="btn btn-outline-secondary">ğŸ‘¤ Ver perfil</a>

      <!-- ConfiguraciÃ³n debajo de perfil -->
      <div class="config-section">
        <button onclick="toggleConfig()" class="btn btn-secondary w-100">âš™ï¸ ConfiguraciÃ³n</button>
        <div id="config-options" class="config-bottom">
          <button id="theme-toggle" class="btn btn-dark w-100">ğŸŒ™ Modo oscuro / claro</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="text-center p-4 bg-azul">
    {% block header_title %}
      <h1 class="m-0">ğŸŒ± EnergÃ­a Renovable</h1>
    {% endblock %}
  </header>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-azul">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarEcoEn" aria-controls="navbarEcoEn" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarEcoEn">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item"><a class="nav-link" href="{% url 'index' %}">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'productos' %}">Productos</a></li>
          <li class="nav-item"><a class="nav-link" href="#reseÃ±as">ReseÃ±as</a></li>
          <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
        </ul>
      </div>
    </div>
  </nav>
{% endif %}

<!-- Chatbot (siempre visible) -->
<div id="chatbot-button" role="button" aria-label="Abrir chatbot">
  <img src="{% static 'img/ecobot.png' %}" alt="EcoBot" style="width: 50px; height: 50px; cursor: pointer;" />
</div>
<div id="chatbot-overlay" class="chatbot-overlay"></div>
<div id="chatbot-window" class="chatbot-window" aria-hidden="true">
  <header id="chatbot-header">ğŸŒ± EcoBot</header>
  <div class="chat-content" id="chatbot-messages"></div>
  <footer id="chatbot-input">
      <input type="text" id="userMessage" placeholder="Escribe aquÃ­..." />
      <button onclick="sendMessage()">â¤</button>
  </footer>
</div>

<!-- Contenido -->
<main class="d-flex flex-column min-vh-100">
  {% block content %}{% endblock %}
</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/chatbot.js' %}"></script>

<script>
  // MenÃº hamburguesa
  function toggleMenu() {
    const menu = document.getElementById("menu-lateral");
    const overlay = document.getElementById("menu-overlay");
    const toggle = document.getElementById("menu-toggle");
    const icon = document.getElementById("menu-icon");

    const isActive = menu.classList.contains("active");

    if (isActive) {
      cerrarMenu();
    } else {
      menu.classList.add("active");
      overlay.classList.add("active");
      toggle.setAttribute("aria-expanded", true);
      menu.setAttribute("aria-hidden", false);
      overlay.setAttribute("aria-hidden", false);
      document.body.classList.add("menu-abierto");

      icon.textContent = "âœ–";
      icon.classList.remove("closed");
      icon.classList.add("open");
    }
  }

  function cerrarMenu() {
    const menu = document.getElementById("menu-lateral");
    const overlay = document.getElementById("menu-overlay");
    const toggle = document.getElementById("menu-toggle");
    const icon = document.getElementById("menu-icon");

    menu.classList.remove("active");
    overlay.classList.remove("active");
    toggle.setAttribute("aria-expanded", false);
    menu.setAttribute("aria-hidden", true);
    overlay.setAttribute("aria-hidden", true);
    document.body.classList.remove("menu-abierto");

    icon.textContent = icon.dataset.default || "â˜°";
    icon.classList.remove("open");
    icon.classList.add("closed");
  }

  // ğŸ”¹ Cerrar menÃº al hacer click fuera (overlay)
  document.getElementById("menu-overlay").addEventListener("click", cerrarMenu);

  // ğŸ”¹ Cerrar menÃº con tecla Escape
  document.addEventListener("keydown", e => { if (e.key === "Escape") cerrarMenu(); });

  // ConfiguraciÃ³n desplegable
  function toggleConfig() {
    const config = document.getElementById("config-options");
    config.classList.toggle("active");
  }

  // Tema oscuro/claro persistente
  const themeToggle = document.getElementById("theme-toggle");
  const savedTheme = localStorage.getItem("ecoen-theme") || "light";
  setTheme(savedTheme);

  function setTheme(mode) {
    document.documentElement.setAttribute("data-bs-theme", mode);
    document.body.classList.toggle("dark-mode", mode === "dark");
    document.body.classList.toggle("light-mode", mode === "light");
    localStorage.setItem("ecoen-theme", mode);
    if (themeToggle) {
      themeToggle.setAttribute("aria-pressed", mode === "dark");
    }
  }

  if (themeToggle) {
    themeToggle.addEventListener("click", () => {
      const current = document.documentElement.getAttribute("data-bs-theme");
      setTheme(current === "dark" ? "light" : "dark");
    });
  }
</script>


{% block extra_js %}{% endblock %}
</body>
</html>
